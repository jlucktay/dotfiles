---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: 3

tasks:
  default: task --list-all

  ### Chezmoi data file and its JSON Schema.

  jq-fmt:data:
    desc: Run the chezmoidata JSON Schema through jq to format it.
    preconditions:
      - sh: command -v jq
        msg: |-
          The 'jq' command is not installed:
          > https://jqlang.org/download/
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - jq . chezmoidata.schema.json > chezmoidata.schema.json.tmp
      - rm -f chezmoidata.schema.json
      - mv chezmoidata.schema.json.tmp chezmoidata.schema.json

  jv:data:
    desc: Run the chezmoidata file through jv to validate it against the JSON Schema.
    preconditions:
      - sh: command -v jv
        msg: |-
          The 'jv' command for validating JSON is not installed:
          $ go install github.com/santhosh-tekuri/jsonschema/cmd/jv@latest
    dir: '{{.TASKFILE_DIR}}'
    cmd: jv --output=detailed chezmoidata.schema.json .chezmoidata.yaml

  data:
    desc: Format the chezmoidata JSON Schema, and validate the '.chezmoidata.yaml' file with it.
    cmds:
      - task: jq-fmt:data
      - task: jv:data
